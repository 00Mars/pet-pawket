<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Account | Pet Pawket</title>

  <!-- CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/css/globals.css" />
  <link rel="stylesheet" href="/css/core.css" />
  <link rel="stylesheet" href="/css/footer.css" />
  <link rel="stylesheet" href="/css/account.css" />
  <link rel="stylesheet" href="/css/pets-traits.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;700&display=swap" rel="stylesheet" />
</head>
<body>
  <header id="navbar-container"></header>

  <main class="container py-5">
    <div class="row g-4">

      <!-- LEFT COLUMN -->
      <div class="col-12 col-lg-3">
        <!-- My Account -->
        <section class="card shadow-sm">
          <div class="card-header" id="myAccountHeader">
            <h2 class="h5 m-0">My Account</h2>
          </div>
          <div class="card-body">
            <p class="text-muted small mb-3">Manage your profile, pets, addresses, and more.</p>

            <!-- Signed out -->
            <div class="mt-2" data-auth="signed-out">
              <div class="alert alert-warning">Please sign in to view your account.</div>
              <a href="/login" class="btn btn-primary w-100">Sign In</a>
            </div>

            <!-- Signed in -->
            <div class="mt-2" data-auth="signed-in" style="display:none;">
              <h3 class="h6">Signed in as</h3>
              <p id="userEmail" data-auth-user-email>Loading your account...</p>
              <div class="mt-2" id="accountActions">
                <button class="btn btn-outline-danger btn-sm" id="logout-btn" data-action="logout">Log Out</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Your Progress -->
        <section class="card shadow-sm mt-4">
          <div class="card-header" id="progressHeader">
            <h2 class="h5 m-0">Your Progress</h2>
          </div>
          <div class="card-body" id="gamification">
            <p class="text-muted mb-0">Profile progress, badges, and milestones will go here.</p>
          </div>
        </section>
      </div>

      <!-- RIGHT COLUMN (auth-gated content) -->
      <div class="col-12 col-lg-9">
        <div class="requires-auth" data-auth-visible="signed-in">

          <!-- Profile Information -->
          <section class="card shadow-sm">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h2 class="h5 m-0">Profile Information</h2>
            </div>
            <div class="card-body" id="profileEditor">
              <form id="profileForm">
                <div class="mb-3">
                  <label class="form-label" for="profileFirstName">First Name</label>
                  <input type="text" class="form-control" id="profileFirstName" placeholder="First name" title="First name" />
                </div>
                <div class="mb-3">
                  <label class="form-label" for="profileLastName">Last Name</label>
                  <input type="text" class="form-control" id="profileLastName" placeholder="Last name" title="Last name" />
                </div>
                <div class="mb-3">
                  <label class="form-label" for="profileEmail">Email</label>
                  <input type="email" class="form-control" id="profileEmail" placeholder="you@example.com" title="Email address" />
                </div>
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <div class="mt-3" id="profileStatus" style="display:none;"></div>
              </form>
            </div>
          </section>

          <!-- Addresses -->
          <section class="card shadow-sm mt-4" id="account-addresses">
            <div class="card-header d-flex align-items-center justify-content-between">
              <h2 class="h5 m-0">Addresses</h2>
              <button class="btn btn-sm btn-outline-primary" id="addressAddBtn">Add Address</button>
            </div>
            <div class="card-body">
              <ul id="addressList" class="list-unstyled m-0 p-0"></ul>
            </div>
          </section>

          <!-- My Pets -->
          <section class="card shadow-sm mt-4" id="account-pets">
            <div class="card-header">
              <h2 class="h5 m-0">My Pets</h2>
            </div>
            <div class="card-body">
              <div id="petList" class="mb-3"></div>

              <hr class="my-3" />

              <form id="addPetForm" class="mt-2">
                <h5 class="h6">Add a New Pet</h5>
                <div class="row g-3">
                  <div class="col-md-4">
                    <input type="text" class="form-control" placeholder="Name" id="newPetName" required />
                  </div>
                  <div class="col-md-4">
                    <input type="text" class="form-control" placeholder="Type (e.g. Dog, Cat)" id="newPetType" required />
                  </div>
                  <div class="col-md-4">
                    <input type="date" class="form-control" placeholder="Birthday" id="newPetBirthday" />
                  </div>
                </div>
                <button type="submit" class="btn btn-outline-primary btn-sm mt-3">Add Pet</button>
              </form>

              <!-- Optional My Pets Pane -->
              <section id="myPetsPane" class="mt-4" aria-label="Guidance & recommendations for your pets" hidden>
                <div class="alert alert-light border d-flex align-items-center justify-content-between mb-3">
                  <div class="d-flex align-items-center gap-2">
                    <i class="bi bi-magic"></i>
                    <div><strong>For My Pets</strong> — guidance, reminders, and subscription picks based on your pets &amp; journals.</div>
                  </div>
                  <div class="form-check form-switch m-0">
                    <input class="form-check-input" type="checkbox" id="toggleMyPetsPane">
                    <label class="form-check-label" for="toggleMyPetsPane">Enable</label>
                  </div>
                </div>
                <div id="myPetsContent"></div>
              </section>
            </div>
          </section>


          
          <section id="wishlistPane" class="card shadow-sm mt-4" role="region" aria-labelledby="wishlistHeading">
            <div class="card-header">
            <h2 id="wishlistHeading" class="h5 m-0">Your Wishlist</h2>
            </div>
            <div class="card-body">
            <div data-wishlist-list aria-live="polite"></div>
            </div>
          </section>

          <!-- Orders -->
          <section class="card shadow-sm mt-4" id="ordersContainer">
            <div class="card-header">
              <h2 class="h5 m-0">Order History</h2>
            </div>
            <div class="card-body">
              <div id="orderHistory" class="mt-2"></div>
            </div>
          </section>

        </div><!-- /requires-auth -->
      </div>
    </div>
  </main>

  <div id="footer-container"></div>

  <!-- Edit Pet Modal (with Traits) -->
  <div id="editPetModal" class="custom-modal hidden" role="dialog" aria-modal="true" aria-labelledby="editPetLabel">
    <div class="modal-content">
      <div class="scrollable-modal">
      <h3 id="editPetLabel">Edit Pet</h3>
      <form id="editPetForm" enctype="multipart/form-data">
        <input type="hidden" id="editPetIndex" />
        <!-- Hidden JSON that the enhancer keeps in sync -->
        <input type="hidden" id="petTraitsJson" name="traits" value="{}" />

        <div class="row g-3">
          <div class="col-md-6">
            <label for="editPetName" class="form-label">Name</label>
            <input type="text" class="form-control" id="editPetName" title="Pet name" placeholder="e.g. Fido" />
          </div>
          <div class="col-md-6">
            <label class="form-label" for="editPetType">Type</label>
            <select class="form-select" id="editPetType">
              <option disabled selected value="">Select a type</option>
              <option>Dog</option><option>Cat</option><option>Bird</option>
              <option>Rabbit</option><option>Hamster</option><option>Guinea Pig</option>
              <option>Reptile</option><option>Fish</option><option>Horse</option>
              <option>Ferret</option><option>Other</option>
            </select>
          </div>

          <!-- Avatar -->
          <div class="col-12 text-center position-relative">
            <label class="form-label d-block mb-2">Avatar</label>
            <div class="d-flex flex-column align-items-center position-relative">
              <img id="avatarPreview" src="/assets/images/default-pet.png" alt="Default pet avatar" title="Pet avatar" class="rounded shadow-sm border mb-3 avatar-preview" />
              <button type="button" id="removeAvatarBtn" class="remove-avatar-btn" title="Remove Avatar">✕</button>
              <label for="editPetAvatar" class="visually-hidden">Upload pet avatar</label>
              <input type="file" class="form-control w-85" id="editPetAvatar" title="Upload pet avatar" aria-label="Upload pet avatar" />
            </div>
          </div>

          <!-- Traits -->
          <div class="col-12">
            <hr class="my-3" />
            <h5 class="mb-2">Traits</h5>

            <!-- BASICS -->
            <div class="trait-section">
              <h6>Basics</h6>
              <div class="trait-grid-2">
                <div class="trait-group">
                  <div class="label">Size</div>
                  <div class="trait-chips" data-trait="size" data-multi="false">
                    <button type="button" class="trait-chip" data-value="xs" aria-pressed="false">XS</button>
                    <button type="button" class="trait-chip" data-value="s"  aria-pressed="false">S</button>
                    <button type="button" class="trait-chip" data-value="m"  aria-pressed="false">M</button>
                    <button type="button" class="trait-chip" data-value="l"  aria-pressed="false">L</button>
                    <button type="button" class="trait-chip" data-value="xl" aria-pressed="false">XL</button>
                  </div>
                </div>

                <div class="trait-group">
                  <div class="label">Sex</div>
                  <div class="trait-chips" data-trait="sex" data-multi="false">
                    <button type="button" class="trait-chip" data-value="male" aria-pressed="false">Male</button>
                    <button type="button" class="trait-chip" data-value="female" aria-pressed="false">Female</button>
                    <button type="button" class="trait-chip" data-value="unknown" aria-pressed="true">Unknown</button>
                  </div>
                </div>

                <div class="trait-group">
                  <div class="label">Spayed/Neutered</div>
                  <div class="trait-chips" data-trait="spayNeuter" data-multi="false">
                    <button type="button" class="trait-chip" data-value="spayed" aria-pressed="false">Spayed</button>
                    <button type="button" class="trait-chip" data-value="neutered" aria-pressed="false">Neutered</button>
                    <button type="button" class="trait-chip" data-value="intact" aria-pressed="false">Intact</button>
                    <button type="button" class="trait-chip" data-value="unknown" aria-pressed="true">Unknown</button>
                  </div>
                </div>

                <div class="trait-group">
                  <div class="label">Chew Strength</div>
                  <div class="trait-chips" data-trait="chewStrength" data-multi="false">
                    <button type="button" class="trait-chip" data-value="soft" aria-pressed="false">Soft</button>
                    <button type="button" class="trait-chip" data-value="moderate" aria-pressed="false">Moderate</button>
                    <button type="button" class="trait-chip" data-value="power" aria-pressed="false">Power</button>
                  </div>
                </div>

                <div class="trait-group mb-2">
                  <div class="label">Play style</div>
                  <div class="trait-chips" data-trait="playStyle" data-multi="false">
                    <button type="button" class="btn btn-sm btn-outline-secondary trait-chip" data-value="unknown" aria-pressed="true">Unknown</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary trait-chip" data-value="fetch"   aria-pressed="false">Fetch</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary trait-chip" data-value="tug"     aria-pressed="false">Tug</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary trait-chip" data-value="chew"    aria-pressed="false">Chew</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary trait-chip" data-value="puzzle"  aria-pressed="false">Puzzle</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary trait-chip" data-value="chase"   aria-pressed="false">Chase</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary trait-chip" data-value="cuddle"  aria-pressed="false">Cuddle</button>
                  </div>
                </div>

                <!-- Catnip (cats only via config) -->
                <div class="trait-group" id="trait-catnip-wrap">
                  <div class="label">Catnip</div>
                  <div class="trait-chips" data-trait="catnip" data-multi="false">
                    <button type="button" class="trait-chip" data-value="likes" aria-pressed="false">Likes it</button>
                    <button type="button" class="trait-chip" data-value="dislikes" aria-pressed="false">Dislikes</button>
                    <button type="button" class="trait-chip" data-value="unknown" aria-pressed="true">Unknown</button>
                  </div>
                </div>
              </div><!-- /trait-grid-2 -->
            </div><!-- /trait-section (Basics) -->

            <!-- DIET -->
            <div class="trait-section">
              <h6>Diet</h6>
              <div class="trait-grid-2">
                <div class="trait-group">
                  <div class="label">Preferences</div>
                  <div class="trait-chips" data-trait="diets" data-multi="true">
                    <button type="button" class="trait-chip" data-value="grain-free" aria-pressed="false">Grain-free</button>
                    <button type="button" class="trait-chip" data-value="limited-ingredient" aria-pressed="false">Limited-ingredient</button>
                    <button type="button" class="trait-chip" data-value="wet" aria-pressed="false">Wet</button>
                    <button type="button" class="trait-chip" data-value="dry" aria-pressed="false">Dry</button>
                    <button type="button" class="trait-chip" data-value="raw" aria-pressed="false">Raw</button>
                    <button type="button" class="trait-chip" data-value="freeze-dried" aria-pressed="false">Freeze-dried</button>
                    <button type="button" class="trait-chip" data-value="high-protein" aria-pressed="false">High-protein</button>
                  </div>
                </div>

                <div class="trait-group">
                  <div class="label">Flavor Likes</div>
                  <div class="trait-chips" data-trait="flavors" data-multi="true">
                    <button type="button" class="trait-chip" data-value="chicken" aria-pressed="false">Chicken</button>
                    <button type="button" class="trait-chip" data-value="beef" aria-pressed="false">Beef</button>
                    <button type="button" class="trait-chip" data-value="salmon" aria-pressed="false">Salmon</button>
                    <button type="button" class="trait-chip" data-value="tuna" aria-pressed="false">Tuna</button>
                    <button type="button" class="trait-chip" data-value="lamb" aria-pressed="false">Lamb</button>
                    <button type="button" class="trait-chip" data-value="duck" aria-pressed="false">Duck</button>
                  </div>
                </div>

                <div class="trait-group">
                  <div class="label">Allergies</div>
                  <div class="trait-inline">
                    <input
                      type="text"
                      name="allergies"
                      data-trait-input="allergies"
                      placeholder="Press Enter to add…"
                      autocomplete="off"
                      enterkeyhint="done" />
                    <div id="trait-allergies" class="trait-chips trait-small" data-trait="allergies" data-multi="true"></div>
                  </div>
                </div>
              </div><!-- /trait-grid-2 -->
            </div><!-- /trait-section (Diet) -->

            <!-- TRAINING / HABITS -->
            <div class="trait-section">
              <h6>Training &amp; Habits</h6>
              <div class="trait-grid-3">
                <div class="trait-group">
                  <div class="label">House Trained</div>
                  <div class="trait-chips" data-trait="houseTrained" data-multi="false">
                    <button type="button" class="trait-chip" data-value="yes" aria-pressed="false">Yes</button>
                    <button type="button" class="trait-chip" data-value="partial" aria-pressed="false">Partial</button>
                    <button type="button" class="trait-chip" data-value="no" aria-pressed="false">No</button>
                    <button type="button" class="trait-chip" data-value="unknown" aria-pressed="true">Unknown</button>
                  </div>
                </div>

                <div class="trait-group">
                  <div class="label">Litter Trained</div>
                  <div class="trait-chips" data-trait="litterTrained" data-multi="false">
                    <button type="button" class="trait-chip" data-value="yes" aria-pressed="false">Yes</button>
                    <button type="button" class="trait-chip" data-value="partial" aria-pressed="false">Partial</button>
                    <button type="button" class="trait-chip" data-value="no" aria-pressed="false">No</button>
                    <button type="button" class="trait-chip" data-value="unknown" aria-pressed="true">Unknown</button>
                  </div>
                </div>
              </div><!-- /trait-grid-3 -->
            </div><!-- /trait-section (Training & Habits) -->

            <!-- FIT & NOTES -->
            <div class="trait-section">
              <h6>Fit & Notes</h6>
              <div class="trait-grid-2">
                <div class="trait-group">
                  <label class="label" for="trait-neck-in">Neck (in)</label>
                  <input id="trait-neck-in" name="neckIn" type="number" min="0" step="0.1" class="form-control" placeholder="e.g. 12.5" title="Neck measurement in inches" />
                </div>
                <div class="trait-group">
                  <label class="label" for="trait-chest-in">Chest (in)</label>
                  <input id="trait-chest-in" name="chestIn" type="number" min="0" step="0.1" class="form-control" placeholder="e.g. 18.0" title="Chest measurement in inches" />
                </div>
                <div class="trait-group">
                  <label class="label" for="trait-back-in">Back (in)</label>
                  <input id="trait-back-in" name="backIn" type="number" min="0" step="0.1" class="form-control" placeholder="e.g. 14.0" title="Back measurement in inches" />
                </div>
                <div class="trait-group">
                  <div class="label">Notes</div>
                  <textarea id="trait-notes" class="form-control" rows="3" placeholder="Anything else we should know?"></textarea>
                </div>
              </div>

              <div class="d-flex justify-content-between align-items-center mt-3">
                <button type="button" class="btn btn-secondary" data-close="editPetModal" aria-label="Cancel and close modal">Cancel</button>
                <button type="submit" class="btn btn-primary" form="editPetForm">Save Changes</button>
              </div>
            </div><!-- /trait-section (Fit & Notes) -->

          </div><!-- /col-12 (Traits) -->
        </div><!-- /row g-3 -->

        <div id="petFormStatus" class="alert alert-info mt-2 d-none" role="status" aria-live="polite"></div>
      </form>
      </div>
    </div>
  </div>

  <!-- Pet Journal Modal -->
  <div id="journal-modal" class="custom-modal hidden" role="dialog" aria-modal="true" aria-labelledby="journalLabel">
    <div class="modal-content">
      <h3 id="journalLabel">Pet Journal</h3>

      <input type="hidden" id="journalPetIndex" value="" aria-hidden="true" />

      <!-- Add Entry -->
      <div id="edit-pet-journal" class="container-fluid">
        <div class="mb-3">
          <label class="form-label">Note</label>
          <textarea class="form-control" id="newJournalNote" rows="2" placeholder="Today's update..."></textarea>
        </div>

        <div class="row g-2">
          <div class="col-12 col-sm-6">
            <label class="form-label" for="journalMood">Mood</label>
            <select class="form-select" id="journalMood">
              <option>Happy</option><option>Playful</option><option>Sleepy</option>
              <option>Calm</option><option>Energetic</option><option>Concerned</option>
            </select>
          </div>
          <div class="col-12 col-sm-6">
            <label class="form-label">Tags</label>
            <input type="text" class="form-control" id="journalTags" placeholder="#vet, #walk, #cute" />
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label" id="journalPhotoLabel" for="journalPhoto">Optional Photo</label>
          <input type="file" class="form-control" id="journalPhoto" accept="image/*" title="Optional photo for journal entry" aria-describedby="journalPhotoLabel" />
        </div>

        <button type="button" class="btn btn-outline-primary btn-sm mt-2" id="addJournalEntryBtn">Add Entry</button>

        <div class="mt-2 pt-1 scrollable-inner">
          <label class="form-label">Recent Journal Entries</label>
          <ul id="journalEntryList" data-component="journalEntries" class="list-unstyled"></ul>
        </div>
      </div>

      <button class="close-btn" data-close="journal-modal" aria-label="Close modal">×</button>
    </div>
  </div>

  <!-- JS (order matters; avoid duplicates) -->
  <script type="module" src="/navbar.js"></script>
  <script type="module" src="/main.js"></script>
  <script type="module" src="/account.js"></script>
  <script type="module" src="/accountPetsTraitsEnhancer.js"></script>
  <script type="module" src="/accountProfileGuard.js"></script>
  <script type="module" src="/accountPetsBridge.js"></script>
  <script type="module" src="/hooksBoot.js"></script>
</body>
</html>